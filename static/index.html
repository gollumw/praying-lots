<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>觀世音靈籤 - 線上抽籤系統</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-overlay"></div>
    
    <div class="container">
        <header>
            <h1>觀世音靈籤</h1>
            <p class="subtitle">誠心祈求，指點迷津</p>
        </header>

        <main>
            <!-- Step 1: Prayer / Question -->
            <section id="step-question" class="active">
                <div class="input-group">
                    <textarea id="user-question" placeholder="請心中默念您的問項，或在此輸入..."></textarea>
                    <button id="btn-start" class="btn-primary">開始擲杯</button>
                </div>
            </section>

            <!-- Step 2: Moon Blocks (擲杯) -->
            <section id="step-blocks" class="hidden">
                <div class="blocks-container">
                    <div id="block-1" class="block"></div>
                    <div id="block-2" class="block"></div>
                </div>
                <div class="controls">
                    <button id="btn-throw" class="btn-primary">擲杯</button>
                </div>
                <div id="block-result" class="result-text"></div>
            </section>

            <!-- Step 3: Draw Lot (抽籤) -->
            <section id="step-draw" class="hidden">
                <div class="lot-stick-container">
                    <div class="stick-bucket">
                        <div class="sticks">
                            <!-- Animated sticks will be handled in CSS/JS -->
                            <div class="stick"></div>
                            <div class="stick"></div>
                            <div class="stick"></div>
                            <div class="stick"></div>
                            <div class="stick"></div>
                        </div>
                    </div>
                </div>
                <div class="controls">
                    <button id="btn-draw" class="btn-gold">抽籤</button>
                </div>
            </section>

            <!-- Step 4: Result (triggers dialog) -->
            <section id="step-result" class="hidden"></section>
        </main>
    </div>

    <!-- 抽籤結果對話視窗：左＝故事＋AI 聊天，右＝籤詩 -->
    <div id="lot-dialog" class="lot-dialog hidden" aria-modal="true">
        <div class="lot-dialog-backdrop"></div>
        <div class="lot-dialog-box">
            <div class="lot-dialog-header">
                <h2 id="dialog-result-title">籤詩結果</h2>
                <button type="button" id="btn-close-dialog" class="btn-close-dialog" aria-label="關閉">×</button>
            </div>
            <div class="lot-dialog-body">
                <div class="lot-dialog-left">
                    <div class="story-block">
                        <h4>籤詩典故與故事</h4>
                        <p id="dialog-story"></p>
                    </div>
                    <div class="chat-block">
                        <h4>與觀世音菩薩聊聊這支籤</h4>
                        <p id="ollama-status" class="ollama-status" aria-live="polite"></p>
                        <div id="chat-messages" class="chat-messages"></div>
                        <div class="chat-input-row">
                            <textarea id="chat-input" class="chat-input" placeholder="輸入想問的話，例如：這支籤對感情有什麼建議？" rows="2"></textarea>
                            <button type="button" id="btn-send-chat" class="btn-send-chat">送出</button>
                        </div>
                    </div>
                </div>
                <div class="lot-dialog-right">
                    <div class="lot-card-compact">
                        <div class="lot-header">
                            <h2 id="dialog-number"></h2>
                            <p id="dialog-level" class="lot-level"></p>
                            <h3 id="dialog-title"></h3>
                        </div>
                        <p class="poem-compact" id="dialog-poem"></p>
                        <div class="lot-meta">
                            <p><strong>詩意</strong> <span id="dialog-meaning"></span></p>
                            <p><strong>解曰</strong> <span id="dialog-explanation"></span></p>
                        </div>
                    </div>
                    <button type="button" id="btn-restart" class="btn-secondary">再次請示</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
